<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/css/bootstrap-slider.min.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/bootstrap-slider.min.js"></script>
    <title>Gone Camping</title>
    <style>
        body {
            height: 100%;
            background-color: transparent;
        }
        
        html {
            background: url("/static/img/camping.jpg") no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            height: 100%;
            margin: 0;
        }
        
        .user-input {
            margin-top: 20px;
            margin-left: 300px;
        }
        
        #search-bar {
            margin-top: 30px;
        }
        
        #select-site {
            color: #555;
            background-color: #fff;
            border-radius: 0.25rem;
            border: 1px solid #6c757d;
            padding: 7px;
            font-size: 0.9em;
            width: 300px;
        }
        
        .site-label {
            color: #fff;
            font-weight: 600;
            display: block;
            font-size: 1.2em;
            text-decoration: underline;
        }
        
        .result {
            background-color: #333;
            border-radius: 0.2rem;
            border: 1px solid #333;
            min-height: 300px;
            width: 100%;
            padding: 7px;
            opacity: 0.9;
            color: #fff;
            margin-bottom: 20px;
        }
        
        .table {
            color: #fff;
        }
        
        .nav-link {
            color: #fff;
            font-weight: 1.2em;
        }
        
        .nav-link:hover {
            color: #fff;
            font-weight: 1.2em;
        }
        #advanced-options{
            color: #fff;
            font-weight: 1.1em;
        }
        #distance-slider .slider-selection {
            background: #BABABA;
        }
        .advanced-option-header{
            font-weight: bold;
        }
        #facility-wrapper{
            display: flex;
        }
        #activity-wrapper{
            display: flex;
        }
        .form-check{
            margin-left: 10px;
        }
        .map {
            height: 300px;  /* The height is 400 pixels */
            width: 100%;  /* The width is the width of the web page */
        }
        #search-result{
            margin-top: 20px;
        }
        .review{
            margin-bottom: 10px;
        }
    </style>
</head>

<body class='body'>
    <header>
        <div class="navbar navbar-dark bg-dark shadow-sm">
            <div class="container d-flex justify-content-between">
                <a href="#" class="navbar-brand d-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2" focusable="false" aria-hidden="true"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                    <strong>Gone Camping</strong>
                </a>
            </div>
        </div>
    </header>
    <div class='container'>
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-lucky-tab" data-toggle="tab" href="#nav-feel-lucky" role="tab" aria-controls="nav-home" aria-selected="true">
                    Feel Lucky
                </a>
                <a class="nav-item nav-link" id="nav-advanced-tab" data-toggle="tab" href="#nav-advanced" role="tab" aria-controls="nav-profile" aria-selected="false">
                    Advanced Search
                </a>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-feel-lucky" role="tabpanel" aria-labelledby="nav-home-tab">
                <div id="content-wrapper">
                    <div class="ui-widget" id='search-bar'>
                        <input id="select-site" placeholder="Type a campground name">
                        <button class='btn btn-secondary' style="display: inline-block" id='search-button'>Search</button>
                    </div>
                    <div id="advanced-options" style='display: none'>
                        <div id="facility-wrapper">
                            <label class='advanced-option-header'>Facilities</label>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="play-ground">
                                <label class="form-check-label" for="play-ground">Play Ground</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="pet-friendly">
                                <label class="form-check-label" for="pet-friendly">Pet-Friendly</label>
                            </div>
                        </div>
                        
                        <div id="activity-wrapper">
                            <label class='advanced-option-header'>Activities</label>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="hiking">
                                <label class="form-check-label" for="hiking">Hiking</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="fishing">
                                <label class="form-check-label" for="fishing">Fishing</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="boating">
                                <label class="form-check-label" for="boating">Boat/Canoe</label>
                            </div>
                        </div>

                        <div id='distance-wrapper'>
                            <label for="distance">Distance From Home: <span id='distance-value'>50KM</span></label><br />
                            <input id="distance" data-slider-id='distance-slider' type="text" data-slider-min="0" data-slider-max="500" data-slider-step="1" data-slider-value="50"/>
                        </div>
                    </div>
                    <div id='search-result'>
                        
                        <!--
                        <table class="table" id='result-table'>
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Address</th>
                                    <th scope="col">Phone</th>
                                    <th scope="col">Overview</th>
                                    <th scope="col">Similarity</th>
                                </tr>
                            </thead>
                        </table>
                        -->
                    </div>
                </div>
                
            </div>
            <div class="tab-pane fade" id="nav-advanced" role="tabpanel" aria-labelledby="nav-profile-tab">
            </div>
        </div>
    </div>
    <script type="text/html" id="result_template">
        <div class='result'>
            <div class='row'>
                <div class="col">
                    <h4 class='title'></h4>
                    <div class='map' id='map1'>map goes here</div>
                </div>
                <div class="col">
                    <div>
                        <div class='site-label'>Review Summary</div>
                        <div class='review'></div>
                    </div>
                    <div>
                        <div class='site-label'>Facilities and Activities</div>
                        <div class='features'></div>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-kqMIZcdDjtIDIyeHU1vZM75nllLG9VM">
    </script>
</body>
<script>
    $(function() {
        var availableSites = [
            {% for name in all_sites %}
            "{{name | safe}}", 
            {% endfor %}
        ];

        var slider = $('#distance').bootstrapSlider().on('slide', function(){
            $('#distance-value').text(slider.val() + 'KM');
        });
        var resetResult = function(){
            $('.result-row').remove();
            $('#select-site').val('')
        };
        $('#nav-lucky-tab').click(function(){
            if($(this).hasClass('active')){
                return;
            }
            resetResult();
            $('#advanced-options').hide();
            $('#content-wrapper').appendTo('#nav-feel-lucky');
        });
        $('#nav-advanced-tab').click(function(){
            if($(this).hasClass('active')){
                return;
            }
            resetResult();
            $('#advanced-options').show();
            $('#content-wrapper').appendTo('#nav-advanced');
        });
        $("#select-site").autocomplete({
            source: availableSites
        });

        var initMap = function(id, lat, lng) {
            var location = {lat: lat, lng: lng};
            // The map, centered at location
            var map = new google.maps.Map(
                document.getElementById(id), {zoom: 7, center: location});
            // The marker, positioned at location
            var marker = new google.maps.Marker({position: location, map: map});
        }

        var process_result = function(data) {
            console.log('success! ');
            console.log(data)
            for (var i = 1; i < data.length; i++) {
                d = data[i];
                row = $($('#result_template').html());
                row.find('.title').html(d.name);
                row.find('.review').html(d.overview);
                map_id = 'map-'+i;
                row.find('.map').attr('id', map_id);
                row.appendTo('#search-result');
                initMap(map_id, d.latitude, d.longitude);
                /*
                row.append(
                    $('<td>').text(i)
                ).append(
                    $('<td>').text(d.name)
                ).append(
                    $('<td>').text(d.address)
                ).append(
                    $('<td>').text(d.phone)
                ).append(
                    $('<td>').text(d.overview)
                ).append(
                    $('<td>').text(d.score.toFixed(2))
                );
                $('#result-table').append(row);
                */
            }

        };
        $('#search-button').click(function() {
            var url = '/recommendations';
            var data = {
                'name': $('#select-site').val()
            }
            if($('#nav-advanced-tab').hasClass('active'))
            {
                //append the other things
                if($('#play-ground').is(':checked')) data['Playground'] = true;
                if($('#pet-friendly').is(':checked')) data['Pet-friendly'] = true;
                if($('#hiking').is(':checked')) data['walking/hiking trails'] = true;
                if($('#fishing').is(':checked')) data['fishing'] = true;
                if($('#boating').is(':checked')) data['boat rental (non-motorized)'] = true;
            }
            console.log(url);
            $.ajax({
                'url': url,
                type: "POST",
                dataType: "json",
                data: JSON.stringify(data),
                contentType: "application/json"
            }).done(process_result)
            .fail(function(data) {
                console.log(data)
            });
        })
    });
</script>

</html>